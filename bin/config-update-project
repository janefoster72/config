#!/usr/bin/env ruby

# This script is so much easier to write in bash, but we want to be able
# to execute it via a gem wrapper, so immediately replace the ruby
# process with a bash script.
exec DATA.read

# Everything below this line is the result of DATA.read.
__END__

set -e

# Require that the working directory has no uncommited changes.
if [ -n "$(git status --porcelain)" ]; then
  echo "git repo is not totally clean." >&2
  exit 1
fi

# Pull in the latest changes cleanly.
git pull --rebase

# Determine whether we are running in a bootstrapped environment or a
# development environment and update the project dependencies.
if [ -n "$(which bundle-config)" ]; then
  bundle-config install
else
  bundle install
fi

exit 0
