echo '[updating packages]'
aptitude update -q
aptitude safe-upgrade -y -q

aptitude install build-essential zlib1g-dev libreadline5-dev libyaml-dev -y -q

echo '[installing git <%= git_version %>]'
aptitude install git-core=<%= apt_git_version %>


mkdir -p /usr/src
cd /usr/src


echo '[downloading ruby <%= ruby_version %>]'
# TODO checksum: bc0c715c69da4d1d8bd57069c19f6c0e
curl -O http://ftp.ruby-lang.org/pub/ruby/1.9/ruby-<%= ruby_version %>.tar.gz
tar -zxf /usr/src/ruby-<%= ruby_version %>.tar.gz


echo '[installing ruby <%= ruby_version %>]'
cd /usr/src/ruby-<%= ruby_version %>
./configure --prefix="/opt/ruby-config-<%= ruby_version %>"
make
make install


echo '[install rubygems <%= rubygems_version %>]'
# NOTE: SSL error on this wtf?
curl -O http://production.cf.rubygems.org/rubygems/rubygems-<%= rubygems_version %>.tgz
tar -zxf rubygems-<%= rubygems_version %>.tgz
cd rubygems-<%= rubygems_version %>
/opt/ruby-config-<%= ruby_version %>/bin/ruby setup.rb --no-format-executable --no-rdoc --no-ri


echo '[installing bundler <%= bundler_version %>]'
/opt/ruby-config-<%= ruby_version %>/bin/gem install bundler --version <%= bundler_version %> --no-ri --no-rdoc


echo '[linking ruby-config]'
echo '#!/bin/sh
set -e
PATH=/opt/ruby-config-<%= ruby_version %>/bin:$PATH exec /opt/ruby-config-<%= ruby_version %>/bin/bundle "$@"
' > /usr/local/bin/ruby-config
chmod +x /usr/local/bin/ruby-config

